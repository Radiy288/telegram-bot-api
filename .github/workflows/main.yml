name: Build Telegram Bot API Server (Windows)

on:
  workflow_dispatch: # –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ GitHub Actions
  push:
    branches:
      - main
      - master

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: üßæ Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: true  # –Ω—É–∂–Ω–æ –¥–ª—è TDLib

      - name: ‚öôÔ∏è Install dependencies
        run: |
          choco install openssl -y
          choco install gperf -y

      - name: üß± Configure CMake
        run: |
          mkdir build
          cd build
          cmake .. -G "Visual Studio 17 2022" -A x64 `
            -DOPENSSL_ROOT_DIR="C:/Program Files/OpenSSL-Win64" `
            -DZLIB_LIBRARY=" " `
            -DZLIB_INCLUDE_DIR=" " `
            -DCMAKE_BUILD_TYPE=Release

      - name: üî® Build
        run: |
          cd build
          cmake --build . --config Release --target install -j4

      - name: üì¶ Upload binary
        uses: actions/upload-artifact@v4
        with:
          name: telegram-bot-api
          path: build/Release/telegram-bot-api.exe
